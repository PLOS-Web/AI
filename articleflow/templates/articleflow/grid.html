{% extends "base.html" %}    

{% load crispy_forms_tags %}
{% load grid %}

{% block head %}
<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}css/grid.css" />
<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
<script src="{{ STATIC_URL }}js/grid.js"></script>
{% endblock %}

{% block main_nav %}
{% include "includes/main_nav.html" with active_tab="grid" %}
{% endblock %}

{% block sub_title %} - grid{% endblock %}

{% block content %}
<h2>Article Grid</h2>

<div class="row">
  <div class="span12 search-accordion">
    <a id="search-collapse-toggle" data-toggle="collapse" data-target="#search-panel">[+] search</a>
    <div class="collapse" id="search-panel">
      <form class="form form-horizontal" action="" method="get">
	{{ filter_form|crispy }}
	<hr />
	<div id="div_id_cols" class="control-group">
	  <label for="id_cols" class="control-label">Select columns</label>
	  <div class="controls">
	    <select multiple="multiple" id="id_cols" class="selectmultiple" name="cols">
	      {% for choice in column_choices %}
	      <option value="{{ choice.0 }}">{{ choice.1 }}</option>
	      {% endfor %}
	    </select>
	  </div>
	</div>
	<div id="div_id_cols" class="control-group">
	  <label for="id_cols" class="control-label">Results per page</label>
	  <div class="controls">
	    <select id="id_cols" class="selectmultiple" name="page_size">
	      <option value="25">25</option>
	      <option value="50">50</option>
	      <option value="100">100</option>
	      <option value="200">200</option>
	    </select>
	  </div>
	</div>
	<div class="control-group">
	  <div class="controls">
	    <input type="submit" name="submit" value="Search">
	  </div>
	</div>
      </form>
    </div>
  </div>
</div>

<span>Showing results {{ pagination.start_index }} - {{ pagination.end_index }} out of {{ total_articles }}
{% if previous_page_qs or next_page_qs %}
|
{% endif %}
</span>

{% if previous_page_qs %}
<a href="?{{ previous_page_qs }}">previous</a>
{% endif %}

{% if next_page_qs %}
<a href="?{{ next_page_qs }}">next</a>
{% endif %}

<table class='table table-hover'>
  <thead>
    <tr>
      {% for col in requested_cols %}
      <th>{{ col }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for article in article_list %}
    <tr>
      {% for col, value in article %}
      <td>
	{% if col == "DOI" %}
	  <a href="{% url detail_main value %}">{{ value }}</a>
	{% elif col == "Issues" %}
	  {% for issue in value %}
	    <span href="#" rel="tootip" title="{{ issue.category }} issues: {{ issue.count}}" class="label label-{{ issue.category|sanitize_class_name }}">{{ issue.count }}</span>
	  {% endfor %}
	{% elif col == "Errors" %}
	    {% for level in value %}
	    <span class="label">{{ level.0 }}s: {{ level.1 }}</span>
	    {% endfor %}
	{% else %}
	  {{ value }}
	{% endif %}
	  
      </td>
      {% endfor %}
    </tr>
    {% endfor %}
  </tbody>
</table>

<span>Showing results {{ pagination.start_index }} - {{ pagination.end_index }} out of {{ total_articles }}
{% if previous_page_qs or next_page_qs %}
|
{% endif %}
</span>

 </span>
{% if previous_page_qs %}
<a href="?{{ previous_page_qs }}">previous</a>
{% endif %}

{% if next_page_qs %}
<a href="?{{ next_page_qs }}">next</a>
{% endif %}

{{ querystring }}
{% endblock %}
